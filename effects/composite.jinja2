{{ '{%' }} extends "{{ base_template }}" {{ '%}' }}
{{ '{% block globals %}' }}
{% for effect in effects %}
  {% include effect.name + ".globals.jinja2" ignore missing %}
{% endfor %}
{{ '{% endblock %}' }}
{{ '{% block effect %}' }}

aInDry = aIn

{{ '{% block parameter_init %}{% endblock %}' }}

{% for effect in effects %}
  aIn = aInDry
  {% for parameter_index in effect.parameter_indexes %}
    k_{{ parameter_names[parameter_index] }} tonek kChannel{{ parameter_index }}[kTime - 1], {{ '{{ parameter_lpf_cutoff }}' }}
  {% endfor %}
  {% include effect.name + ".effect.jinja2" %}
  a_{{ effect.name }} = aOut
{% endfor %}

i_mix_per_effect = 1 / {{ effects|length }}
aOut = i_mix_per_effect * ({% for effect in effects %}a_{{ effect.name }} * i_mix_per_effect{% if not loop.last %} + {% endif %}{% endfor %})
{{ '{% endblock %}' }}
